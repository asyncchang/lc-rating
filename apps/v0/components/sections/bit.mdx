# FenwickTree（樹狀數組）

## 模板一 區間和, 單點更新，區間查詢
> 例題 [307. 區域和檢索 - 數組可修改](https://leetcode.cn/problems/range-sum-query-mutable/)
```Python3
class FenwickTree:
    def __init__(self, size):
        self.size = size
        self.tree = [0] * (size + 1)
        self.nums = [0] * size

    def update(self, index, v): # 直接替換，如果 v 是 delta 就不需要額外維護 數組？
        """
        單點更新，將索引index處的值增加delta
        :param index: 要更新的索引 (1-based)
        :param delta: 增量
        """
        delta = v - self.nums[index - 1]
        self.nums[index - 1] = v
        while index <= self.size:
            self.tree[index] += delta
            index += index & -index

    def query(self, index):
        """
        查詢從1到index的前綴和
        :param index: 查詢的終止索引 (1-based)
        :return: 前綴和
        """
        sum = 0
        while index > 0:
            sum += self.tree[index]
            index -= index & -index
        return sum

    def range_query(self, left, right):
        """
        查詢區間和 [left, right]
        :param left: 區間起始索引 (1-based)
        :param right: 區間結束索引 (1-based)
        :return: 區間和
        """
        return self.query(right) - self.query(left - 1)

class NumArray:

    def __init__(self, nums: List[int]):
        self.fwk = FenwickTree(len(nums))
        for i, x in enumerate(nums):
            self.fwk.update(i + 1, x)

    def update(self, index: int, val: int) -> None:
        self.fwk.update(index + 1, val)

    def sumRange(self, left: int, right: int) -> int:
        return self.fwk.range_query(left + 1, right + 1)
```